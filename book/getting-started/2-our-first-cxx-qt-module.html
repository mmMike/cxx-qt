<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Our first CXX-Qt module - CXX-Qt Documentation</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../index.html">Introduction</a></li><li class="spacer"></li><li class="chapter-item expanded "><a href="../getting-started/index.html"><strong aria-hidden="true">1.</strong> Getting Started</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../getting-started/1-qobjects-in-rust.html"><strong aria-hidden="true">1.1.</strong> QObjects in Rust</a></li><li class="chapter-item expanded "><a href="../getting-started/2-our-first-cxx-qt-module.html" class="active"><strong aria-hidden="true">1.2.</strong> Our first CXX-Qt module</a></li><li class="chapter-item expanded "><a href="../getting-started/3-qml-gui.html"><strong aria-hidden="true">1.3.</strong> Creating the QML GUI</a></li><li class="chapter-item expanded "><a href="../getting-started/4-cmake-integration.html"><strong aria-hidden="true">1.4.</strong> Building with CMake</a></li><li class="chapter-item expanded "><a href="../getting-started/5-cargo-executable.html"><strong aria-hidden="true">1.5.</strong> Building with Cargo</a></li></ol></li><li class="chapter-item expanded "><a href="../qobject/index.html"><strong aria-hidden="true">2.</strong> QObject</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../qobject/bridge-macro.html"><strong aria-hidden="true">2.1.</strong> #[cxx_qt::bridge] - Bridge Macro</a></li><li class="chapter-item expanded "><a href="../qobject/qobject_struct.html"><strong aria-hidden="true">2.2.</strong> #[cxx_qt::qobject] - Defining QObjects</a></li><li class="chapter-item expanded "><a href="../qobject/signals_enum.html"><strong aria-hidden="true">2.3.</strong> #[cxx_qt::qsignals] - Signals enum</a></li><li class="chapter-item expanded "><a href="../qobject/generated-qobject.html"><strong aria-hidden="true">2.4.</strong> qobject::T - The generated QObject</a></li><li class="chapter-item expanded "><a href="../qobject/cxxqtthread.html"><strong aria-hidden="true">2.5.</strong> CxxQtThread</a></li></ol></li><li class="chapter-item expanded "><a href="../concepts/index.html"><strong aria-hidden="true">3.</strong> Concepts</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../concepts/bridge.html"><strong aria-hidden="true">3.1.</strong> Bridge</a></li><li class="chapter-item expanded "><a href="../concepts/qt.html"><strong aria-hidden="true">3.2.</strong> Qt</a></li><li class="chapter-item expanded "><a href="../concepts/types.html"><strong aria-hidden="true">3.3.</strong> Types</a></li><li class="chapter-item expanded "><a href="../concepts/type-conversions.html"><strong aria-hidden="true">3.4.</strong> Type Conversions</a></li><li class="chapter-item expanded "><a href="../concepts/build_systems.html"><strong aria-hidden="true">3.5.</strong> Build Systems</a></li><li class="chapter-item expanded "><a href="../concepts/threading.html"><strong aria-hidden="true">3.6.</strong> Threading</a></li><li class="chapter-item expanded "><a href="../concepts/nested_objects.html"><strong aria-hidden="true">3.7.</strong> Nested Objects</a></li><li class="chapter-item expanded "><a href="../concepts/inheritance.html"><strong aria-hidden="true">3.8.</strong> Inheritance &amp; Overriding</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">CXX-Qt Documentation</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <!--
SPDX-FileCopyrightText: 2022 KlarÃ¤lvdalens Datakonsult AB, a KDAB Group company <info@kdab.com>
SPDX-FileContributor: Leon Matthes <leon.matthes@kdab.com>

SPDX-License-Identifier: MIT OR Apache-2.0
-->
<h1 id="our-first-cxx-qt-module"><a class="header" href="#our-first-cxx-qt-module">Our first CXX-Qt module</a></h1>
<p>We first need to create a folder structure to add the different parts of our project.</p>
<pre><code class="language-ignore">tutorial
  - cpp
  - qml
  - rust
</code></pre>
<p>As with all things Rust, we'll want to create a cargo project, run the following command inside the <code>tutorial</code> folder to initialise the Rust part of the project.</p>
<pre><code class="language-bash">cargo init --lib rust
</code></pre>
<p>Note the <code>--lib</code> option here. For this example, we will create a static library in Rust and use CMake to
link this into a C++ executable. We'll discuss details of this later, when we <a href="./4-cmake-integration.html">integrate our Rust project with CMake</a>.</p>
<p>As outlined in the previous section, to define a new QObject subclass, we'll create a Rust module within this library crate.
First, in the <code>rust/src/lib.rs</code>, we tell Cargo about the module we're about to create:</p>
<pre><code class="language-rust ignore">mod cxxqt_object;
</code></pre>
<p>Now, we need to create a file <code>rust/src/cxxqt_object.rs</code> for that module.
It will include our <code>#[cxx_qt::bridge]</code> that allows us to create our own qobjects in Rust:</p>
<pre><code class="language-rust ignore">
#[cxx_qt::bridge]
mod my_object {

    unsafe extern &quot;C++&quot; {
        include!(&quot;cxx-qt-lib/qstring.h&quot;);
        type QString = cxx_qt_lib::QString;
    }

    #[cxx_qt::qobject(qml_uri = &quot;com.kdab.cxx_qt.demo&quot;, qml_version = &quot;1.0&quot;)]
    pub struct MyObject {
        #[qproperty]
        number: i32,
        #[qproperty]
        string: QString,
    }

    impl Default for MyObject {
        fn default() -&gt; Self {
            Self {
                number: 0,
                string: QString::from(&quot;&quot;),
            }
        }
    }

    impl qobject::MyObject {
        #[qinvokable]
        pub fn increment_number(self: Pin&lt;&amp;mut Self&gt;) {
            let previous = *self.as_ref().number();
            self.set_number(previous + 1);
        }

        #[qinvokable]
        pub fn say_hi(&amp;self, string: &amp;QString, number: i32) {
            println!(&quot;Hi from Rust! String is '{string}' and number is {number}&quot;);
        }
    }
}
</code></pre>
<p>This is a lot to take in, so let's go one step at a time.</p>
<h2 id="cxx-qt-bridge-module"><a class="header" href="#cxx-qt-bridge-module">CXX-Qt bridge module</a></h2>
<p>Starting with the module definition:</p>
<pre><code class="language-rust ignore">
#[cxx_qt::bridge]
mod my_object {
    // ...
}
</code></pre>
<p>A <code>#[cxx_qt::bridge]</code> is the same as a <code>#[cxx::bridge]</code> and you can use all features of CXX in it.
Additionally, a <code>#[cxx_qt::bridge]</code> gives you a few more features that allow you to create QObjects.</p>
<h2 id="qobject-struct"><a class="header" href="#qobject-struct">QObject struct</a></h2>
<p>To create a new QObject subclass, we can define a struct within our module and mark it with <code>#[cxx_qt::qobject]</code>.</p>
<pre><code class="language-rust ignore">    #[cxx_qt::qobject(qml_uri = &quot;com.kdab.cxx_qt.demo&quot;, qml_version = &quot;1.0&quot;)]
    pub struct MyObject {
        #[qproperty]
        number: i32,
        #[qproperty]
        string: QString,
    }
</code></pre>
<p>Optionally, add <code>qml_uri</code> and <code>qml_version</code> inside <code>#[cxx_qt::qobject]</code> to tell the Rust build script to generate a QML plugin
that will register the QObject with QML engine at startup. If you want the name of the QML type and the Rust type to be different,
you can also add <code>qml_name = &quot;OtherName&quot;</code>. This takes the place of the
<a href="https://doc.qt.io/qt-6/qt-add-qml-module.html">qt_add_qml_module CMake function</a> (because that doesn't work with CXX-Qt's build system).</p>
<p>Additionally, we need to either <code>impl Default</code> or <code>#[derive(Default)]</code> for our struct.</p>
<pre><code class="language-rust ignore">    impl Default for MyObject {
        fn default() -&gt; Self {
            Self {
                number: 0,
                string: QString::from(&quot;&quot;),
            }
        }
    }
</code></pre>
<p>The Rust struct can be defined just like a normal Rust struct and can contain any kind of field, even Rust-only types.
If a field is marked as <code>#[qproperty]</code> it will be exposed to the C++ side as a <code>Q_PROPERTY</code>.</p>
<p>That means the newly created QObject subclass will have two properties as members: <code>number</code> and <code>string</code>. For names that contain multiple words, like <code>my_number</code>, CXX-Qt will automatically rename the field from snake_case to camelCase to fit with C++/QML naming conventions (e.g. <code>myNumber</code>).</p>
<h3 id="types"><a class="header" href="#types">Types</a></h3>
<p>Do note though that any fields marked as <code>#[qproperty]</code> must be types that CXX can translate to C++ types.
In our case that means:</p>
<ul>
<li><code>number: i32</code> -&gt; <code>::std::int32_t number</code></li>
<li><code>string: QString</code> -&gt; <code>QString string</code></li>
</ul>
<p>For <code>i32</code>, CXX-Qt already knows how to translate it.
A <code>QString</code> however is unknown to CXX.
Luckily, the <a href="https://docs.rs/cxx-qt-lib/latest/cxx_qt_lib/"><code>cxx_qt_lib</code></a> crate already wraps many Qt types for us.
We can just import them like any other CXX type:</p>
<pre><code class="language-rust  ignore">    unsafe extern &quot;C++&quot; {
        include!(&quot;cxx-qt-lib/qstring.h&quot;);
        type QString = cxx_qt_lib::QString;
    }
</code></pre>
<p>For more details on the available types, see the <a href="../concepts/types.html">Qt types page</a>.</p>
<h2 id="qobjectt"><a class="header" href="#qobjectt">qobject::T</a></h2>
<p>CXX-Qt will then automatically generate a new QObject subclass for our <code>MyObject</code> struct and expose it as an <a href="https://cxx.rs/extern-c++.html#opaque-c-types"><code>extern &quot;C++&quot;</code> opaque type</a> to Rust.
For any Rust struct <code>T</code> that is marked with <code>#[cxx_qt::qobject]</code>, CXX-Qt will expose the corresponding C++ QObject under <code>qobject::T</code>.
In our case, this means we can refer to the C++ QObject for our <code>MyObject</code> struct, as <code>qobject::MyObject</code>.</p>
<p>This type can be used like any other CXX opaque type.
Additionally, CXX-Qt allows us to add functionality to this QObject by using <code>impl qobject::MyObject</code> together with <code>#[qinvokable]</code>.</p>
<pre><code class="language-rust ignore">    impl qobject::MyObject {
        #[qinvokable]
        pub fn increment_number(self: Pin&lt;&amp;mut Self&gt;) {
            let previous = *self.as_ref().number();
            self.set_number(previous + 1);
        }

        #[qinvokable]
        pub fn say_hi(&amp;self, string: &amp;QString, number: i32) {
            println!(&quot;Hi from Rust! String is '{string}' and number is {number}&quot;);
        }
    }
</code></pre>
<p>In our case, we define two new functions:</p>
<ul>
<li><code>increment_number</code>
<ul>
<li>Increments the number of the <code>MyObject</code>.</li>
<li>The name will be converted to <code>incrementNumber</code> in C++.</li>
</ul>
</li>
<li><code>say_hello</code>
<ul>
<li>Prints a provided number and string.</li>
<li>The name will be converted to <code>sayHello</code> in C++.</li>
</ul>
</li>
</ul>
<p>Because we are implementing on the <code>qobject::MyObject</code> type instead of the <code>MyObject</code> type, <code>self</code> here is the C++ QObject that is generated from our <code>MyObject</code> struct.
As this type is a CXX Opaque type, we can't actually instantiate it.
Qt/C++ takes care of this.
However, we can still define Rust functions on this type.
They will just be normal Rust functions, but will be executed on a C++ type.
CXX-Qt will already generate getters and setters for all fields of your struct this way.
If you additionally mark any of these functions with <code>#[qinvokable]</code>, they will also be callable from C++ and QML.
In this case, the types of the arguments also need to convertable to C++, like with any <code>#[qproperty]</code>.</p>
<p>And that's it. We've defined our first QObject subclass in Rust. That wasn't so hard, was it?</p>
<p>Now let's get to <a href="./3-qml-gui.html">using it in Qt</a>.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../getting-started/1-qobjects-in-rust.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../getting-started/3-qml-gui.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../getting-started/1-qobjects-in-rust.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../getting-started/3-qml-gui.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
